{"version":3,"sources":["../../server/src/controllers/mealControllers.js"],"names":["fs","require","MealControllers","req","res","Meal","findAll","where","catererId","meals","status","json","message","data","body","name","price","image","files","imageUrl","create","meal","mv","findOne","id","params","Error","mealUpdate","unlink","err","update","destroy","module","exports"],"mappings":"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","sourcesContent":["var fs = require(\"fs\");\n//import Meal from \"../models/meals\";\n\nclass MealControllers {\n  static async getMeal(req, res) {\n    try {\n      const meals = await Meal.findAll({\n        where: { catererId: 2 }\n      });\n      return res.status(200).json({\n        status: \"success\",\n        message: \"Meals Retrieved\",\n        data: meals\n      });\n    } catch (err) {\n      return res.status(500).json({\n        status: \"error\",\n        message: \"Failed to Retrieve Meals\"\n      });\n    }\n  }\n\n  static async postMeal(req, res) {\n    try {\n      const { name, price } = req.body;\n      const { image } = req.files;\n      const imageUrl = `/src/images/${image.name}`;\n      const meal = await Meal.create({\n        name,\n        price,\n        imageUrl,\n        catererId: 2\n      });\n      await image.mv(`.${imageUrl}`);\n      return res.status(201).json({\n        status: \"success\",\n        message: \"Meal Option Added\",\n        data: meal\n      });\n    } catch (err) {\n      return res.status(500).json({\n        status: \"error\",\n        message: err.message\n      });\n    }\n  }\n\n  static async updateMealName(req, res) {\n    try {\n      const meal = await Meal.findOne({ where: { id: req.params.id } });\n      if (!meal) {\n        throw new Error(`Meal With ID ${req.params.id} does not exist`);\n      }\n      const mealUpdate = {\n        name: req.body.name ? req.body.name : meal.name,\n        price: req.body.price ? req.body.price : meal.price\n      };\n      if (req.files !== null) {\n        const { image } = req.files;\n        const imageUrl = `/src/images/${image.name}`;\n        fs.unlink(`.${meal.imageUrl}`, err => {\n          if (err) throw new Error(err.message);\n        });\n        mealUpdate.imageUrl = imageUrl;\n        await image.mv(`.${imageUrl}`);\n      } else {\n        mealUpdate.imageUrl = meal.imageUrl;\n      }\n      const { name, price, imageUrl } = mealUpdate;\n      await Meal.update(\n        { name, price, imageUrl },\n        { where: { id: req.params.id } }\n      );\n      return res.status(200).json({\n        status: \"success\",\n        message: \"Meal Option Updated\"\n      });\n    } catch (err) {\n      return res.status(500).json({\n        status: \"error\",\n        message: err.message\n      });\n    }\n  }\n\n  static async deleteMeal(req, res) {\n    try {\n      const { id } = req.params;\n      const meal = await Meal.findOne({ where: { id } });\n      fs.unlink(`.${meal.imageUrl}`, err => {\n        if (err) throw new Error(err.message);\n      });\n      await meal.destroy();\n      return res.status(200).json({\n        status: \"success\",\n        message: \"Meal Option Deleted\"\n      });\n    } catch (err) {\n      return res.status(500).json({\n        status: \"error\",\n        message: err.message\n      });\n    }\n  }\n\n  \n}\n\n\nmodule.exports = MealControllers;\n"],"file":"mealControllers.js"}